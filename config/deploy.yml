# Name of your application. Used to uniquely configure containers.
service: mydove-kamal-reservation

# Name of the container image.
image: dovewallethq/reservation

# Deploy to these servers.
servers:
  web:
    - 146.190.33.205
#
# Note: If using Cloudflare, set encryption mode in SSL/TLS setting to "Full" to enable CF-to-app encryption.
proxy:
  ssl: true
  host: reservation.dovewallet.co
  app_port: 8080
  healthcheck:
    interval: 5
    path: /health
    timeout: 5

# Credentials for your image host.
registry:
  # Specify the registry server, if you're not using Docker Hub
   server: ghcr.io
   username: dovewalletHQ
   password:
     - KAMAL_REGISTRY_PASSWORD

# Configure builder setup.
# Build on remote server to avoid local network issues
builder:
  remote: 146.190.33.205
  arch: amd64

# Inject ENV variables into containers (secrets come from .kamal/secrets).

env:
  clear:
    # Redis connection (Kamal accessory provides the hostname automatically)
    REDIS_HOST: mydove-kamal-redis
    REDIS_PORT: "6379"
    REDIS_USERNAME: default

    # Timeouts and limits (non-sensitive)
    OGATEWAY_TIMEOUT: "30"
    OGATEWAY_RATE_LIMIT_PER_MINUTE: "60"
    WEBHOOK_RATE_LIMIT_PER_MINUTE: "60"
    WEBHOOK_RATE_LIMIT_PER_IP: "20"
    ACCESS_TOKEN_EXPIRE_MINUTES: "60"
    JWT_EXPIRE_MINUTES: "1440"
    OTP_EXPIRE_SECONDS: "300"
    DEFAULT_CACHE_EXPIRE: "3600"
    ENABLE_SYSTEM_MONITORING: "false"

  secret:
    # Database credentials (external MongoDB)
    - MONGO_DSN
    - MONGO_DB_NAME



ssh:
  user: tiny-dove
  keys: ["~/.ssh/tiny_dove"]